#!/bin/bash

echo "[TASK 1]  Add update the package sources"
sudo rpm --import 'https://download.ceph.com/keys/release.asc'
cat >>/etc/yum.repos.d/ceph.repo<<EOF
[ceph]
name=Ceph packages for $basearch
baseurl=https://download.ceph.com/rpm-nautilus/el7/$basearch
enabled=1
priority=2
gpgcheck=1
gpgkey=https://download.ceph.com/keys/release.asc

[ceph-noarch]
name=Ceph noarch packages
baseurl=https://download.ceph.com/rpm-nautilus/el7//noarch
enabled=1
priority=2
gpgcheck=1
gpgkey=https://download.ceph.com/keys/release.asc

[ceph-source]
name=Ceph source packages
baseurl=https://download.ceph.com/rpm-nautilus/el7/SRPMS
enabled=0
priority=2
gpgcheck=1
gpgkey=https://download.ceph.com/keys/release.asc
EOF

echo "[TASK 2]  "Change user"
su vagrant

echo "[TASK 3]  "Ssh-keygen"
ssh-keygen
cat >>~/.ssh/config<<EOF
Host ceph-node-1
        Hostname ceph-node-1
        User vagrant

Host ceph-node-2
        Hostname ceph-node-2
        User vagrant

Host ceph-node-3
        Hostname ceph-node-3
        User vagrant
EOF
chmod 600 ~/.ssh/config

echo "[TASK 4]  "Ssh-copy-id"
ssh-copy-id vagrant@ceph-node-1
ssh-copy-id vagrant@ceph-node-2
ssh-copy-id vagrant@ceph-node-3

echo "[TASK 5]  "Install Ceph-Deploy"
sudo yum install ceph-deploy
mkdir ceph-cluster
cd ceph-cluster

ceph-deploy new ceph-node-1 ceph-node-2 ceph-node-3

ceph-deploy install --release nautilus ceph-node-1 ceph-node-2 ceph-node-3

ceph-deploy mon create-initial

ceph-deploy admin ceph-node-1 ceph-node-2 ceph-node-3

ceph-deploy mgr create ceph-node-1

ceph-deploy mds create ceph-node-1 ceph-node-2 ceph-node-3



